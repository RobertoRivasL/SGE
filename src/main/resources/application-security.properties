# ============================================================================
# SPRING SECURITY CONFIGURATION
# ============================================================================
# Proyecto: InformViva - Sistema de Gestión Empresarial
# Configuración de seguridad y control de acceso basado en roles
# Autor: Roberto Rivas
# Fecha: 2025-11-09
# ============================================================================

# ============================================================================
# CONFIGURACIÓN DE BCRYPT PASSWORD ENCODER
# ============================================================================
# Fuerza del algoritmo BCrypt (4-31, recomendado: 10-12)
security.password.bcrypt.strength=10

# ============================================================================
# CONFIGURACIÓN DE SESIONES
# ============================================================================
# Tiempo máximo de inactividad de sesión (en segundos)
server.servlet.session.timeout=1800

# Configuración de cookies de sesión
server.servlet.session.cookie.name=INFORMVIVA_SESSION
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=lax
server.servlet.session.cookie.max-age=1800

# Estrategia de sesión
# Opciones: always, never, if_required, stateless
spring.security.sessions.strategy=if_required

# Número máximo de sesiones concurrentes por usuario
spring.security.sessions.max=1

# Acción al exceder sesiones: true = prevenir login, false = expirar sesión antigua
spring.security.sessions.prevent-on-max=false

# ============================================================================
# CONFIGURACIÓN DE REMEMBER ME
# ============================================================================
security.remember-me.enabled=true
security.remember-me.key=InformVivaRememberMeKey2024SecureToken
security.remember-me.token-validity-seconds=604800
security.remember-me.cookie.name=INFORMVIVA_REMEMBER_ME
security.remember-me.cookie.http-only=true
security.remember-me.cookie.secure=false

# ============================================================================
# CONFIGURACIÓN DE LOGIN/LOGOUT
# ============================================================================
# URLs de autenticación
security.login.url=/login
security.login.processing-url=/perform_login
security.login.success-url=/dashboard
security.login.failure-url=/login?error=true
security.login.username-parameter=username
security.login.password-parameter=password

# URLs de logout
security.logout.url=/logout
security.logout.success-url=/login?logout=true
security.logout.invalidate-session=true
security.logout.delete-cookies=JSESSIONID,INFORMVIVA_SESSION

# ============================================================================
# CONFIGURACIÓN DE CORS
# ============================================================================
security.cors.enabled=true
security.cors.allowed-origins=http://localhost:8080,http://localhost:3000
security.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS,PATCH
security.cors.allowed-headers=*
security.cors.exposed-headers=Authorization,Content-Type
security.cors.allow-credentials=true
security.cors.max-age=3600

# ============================================================================
# CONFIGURACIÓN DE CSRF
# ============================================================================
security.csrf.enabled=true
security.csrf.token-repository=cookie
security.csrf.cookie.name=XSRF-TOKEN
security.csrf.cookie.http-only=false
security.csrf.header-name=X-XSRF-TOKEN

# URLs excluidas de protección CSRF (APIs REST)
security.csrf.ignored-paths=/api/**,/actuator/**

# ============================================================================
# CONFIGURACIÓN DE HEADERS DE SEGURIDAD
# ============================================================================
# X-Content-Type-Options
security.headers.content-type-options=nosniff

# X-Frame-Options (protección contra clickjacking)
# Opciones: DENY, SAMEORIGIN, ALLOW-FROM uri
security.headers.frame-options=SAMEORIGIN

# X-XSS-Protection
security.headers.xss-protection=1; mode=block

# Strict-Transport-Security (HSTS) - solo para HTTPS
security.headers.hsts.enabled=false
security.headers.hsts.max-age=31536000
security.headers.hsts.include-subdomains=true

# Content-Security-Policy
security.headers.csp.enabled=false
security.headers.csp.policy=default-src 'self'

# ============================================================================
# CONFIGURACIÓN DE POLÍTICAS DE CONTRASEÑA
# ============================================================================
# Longitud mínima de contraseña
security.password.min-length=8

# Longitud máxima de contraseña
security.password.max-length=128

# Requerir al menos una letra mayúscula
security.password.require-uppercase=true

# Requerir al menos una letra minúscula
security.password.require-lowercase=true

# Requerir al menos un número
security.password.require-digit=true

# Requerir al menos un carácter especial
security.password.require-special-char=false

# Caracteres especiales permitidos
security.password.special-chars=!@#$%^&*()_+-=[]{}|;:,.<>?

# ============================================================================
# CONFIGURACIÓN DE BLOQUEO DE CUENTA
# ============================================================================
# Habilitar bloqueo de cuenta por intentos fallidos
security.account.lockout.enabled=true

# Número máximo de intentos fallidos antes de bloquear
security.account.lockout.max-attempts=5

# Tiempo de bloqueo en segundos (600 = 10 minutos)
security.account.lockout.duration=600

# ============================================================================
# CONFIGURACIÓN DE EXPIRACIÓN DE CONTRASEÑA
# ============================================================================
# Habilitar expiración de contraseñas
security.password.expiration.enabled=false

# Días hasta que expire la contraseña
security.password.expiration.days=90

# Días de advertencia antes de expiración
security.password.expiration.warning-days=7

# ============================================================================
# CONTROL DE ACCESO BASADO EN ROLES - URL PATTERNS
# ============================================================================

# ============================
# URLs PÚBLICAS (sin autenticación)
# ============================
security.public.patterns=/,/login,/logout,/error,/css/**,/js/**,/images/**,/webjars/**,/favicon.ico

# ============================
# ADMIN - Acceso completo al sistema
# ============================
# Módulos exclusivos de ADMIN
security.admin.patterns=/admin/**,/usuarios/**,/roles/**,/permisos/**,/configuracion/**,/sistema/**,/auditoria/**

# ============================
# GERENTE DE COMPRAS - Módulo de compras + áreas comunes
# ============================
# Módulo de compras
security.gerente-compras.patterns=/compras/**,/proveedores/**,/ordenes-compra/**,/recepciones/**,/pagos-proveedores/**

# ============================
# GERENTE DE VENTAS - Módulo de ventas + áreas comunes
# ============================
# Módulo de ventas
security.gerente-ventas.patterns=/ventas/**,/clientes/**,/cotizaciones/**,/facturas/**,/reportes/ventas/**,/estadisticas/ventas/**,/comisiones/**

# ============================
# ÁREAS COMUNES - Acceso para GERENTES (ambos)
# ============================
security.gerentes-comunes.patterns=/dashboard,/reportes/generales/**,/estadisticas/generales/**,/productos/consulta/**,/inventario/consulta/**

# ============================
# VENDEDOR - Acceso limitado a ventas
# ============================
security.vendedor.patterns=/ventas/crear,/ventas/editar/**,/ventas/ver/**,/clientes/crear,/clientes/editar/**,/clientes/ver/**,/productos/buscar,/cotizaciones/crear

# ============================
# BODEGUERO - Acceso a inventario
# ============================
security.bodeguero.patterns=/inventario/**,/productos/stock/**,/movimientos/**,/transferencias/**,/ajustes-inventario/**,/recepciones/inventario/**

# ============================
# USUARIO - Acceso básico de lectura
# ============================
security.usuario.patterns=/dashboard,/productos/ver/**,/clientes/ver/**,/reportes/ver/**

# ============================================================================
# JERARQUÍA DE ROLES
# ============================================================================
# Definir jerarquía de roles (ADMIN hereda todos los permisos)
security.role.hierarchy=ROLE_ADMIN > ROLE_GERENTE_COMPRAS \
  ROLE_ADMIN > ROLE_GERENTE_VENTAS \
  ROLE_ADMIN > ROLE_BODEGUERO \
  ROLE_ADMIN > ROLE_VENDEDOR \
  ROLE_ADMIN > ROLE_USUARIO \
  ROLE_GERENTE_COMPRAS > ROLE_USUARIO \
  ROLE_GERENTE_VENTAS > ROLE_USUARIO \
  ROLE_BODEGUERO > ROLE_USUARIO \
  ROLE_VENDEDOR > ROLE_USUARIO

# ============================================================================
# CONFIGURACIÓN DE PERMISOS POR ROL
# ============================================================================

# ADMIN - Todos los permisos
security.role.admin.permissions=CREATE,READ,UPDATE,DELETE,EXPORT,IMPORT,ADMIN

# GERENTE_COMPRAS - Permisos de compras
security.role.gerente-compras.permissions=CREATE,READ,UPDATE,EXPORT

# GERENTE_VENTAS - Permisos de ventas
security.role.gerente-ventas.permissions=CREATE,READ,UPDATE,EXPORT

# VENDEDOR - Permisos limitados
security.role.vendedor.permissions=CREATE,READ

# BODEGUERO - Permisos de inventario
security.role.bodeguero.permissions=CREATE,READ,UPDATE

# USUARIO - Solo lectura
security.role.usuario.permissions=READ

# ============================================================================
# CONFIGURACIÓN DE AUDITORÍA
# ============================================================================
security.audit.enabled=true
security.audit.log-authentication=true
security.audit.log-authorization=true
security.audit.log-password-changes=true
security.audit.log-account-lockout=true

# ============================================================================
# CONFIGURACIÓN DE RATE LIMITING
# ============================================================================
# Habilitar limitación de tasa de peticiones
security.rate-limit.enabled=true

# Número máximo de peticiones por minuto por IP
security.rate-limit.max-requests-per-minute=100

# Tiempo de bloqueo en segundos por exceder límite
security.rate-limit.block-duration=60

# ============================================================================
# CONFIGURACIÓN DE PROTECCIÓN CONTRA ATAQUES
# ============================================================================
# Protección contra fuerza bruta
security.brute-force.protection.enabled=true

# Protección contra 'session fixation'
security.session-fixation.protection=migrateSession

# Protección contra 'clickjacking'
security.clickjacking.protection=SAMEORIGIN

# ============================================================================
# CONFIGURACIÓN DE TOKENS DE VERIFICACIÓN
# ============================================================================
# Tiempo de validez de tokens de verificación de email (en segundos)
security.token.verification.validity=86400

# Tiempo de validez de tokens de recuperación de contraseña (en segundos)
security.token.password-reset.validity=3600

# ============================================================================
# CONFIGURACIÓN DE OAUTH2/SOCIAL LOGIN (Futuro)
# ============================================================================
security.oauth2.enabled=false

# ============================================================================
# CONFIGURACIÓN DE TWO-FACTOR AUTHENTICATION (Futuro)
# ============================================================================
security.2fa.enabled=false

# ============================================================================
# CONFIGURACIÓN DE IP WHITELISTING
# ============================================================================
# Habilitar whitelist de IPs para endpoints sensibles
security.ip-whitelist.enabled=false
security.ip-whitelist.admin.ips=127.0.0.1,::1

# ============================================================================
# MENSAJES DE SEGURIDAD PERSONALIZADOS
# ============================================================================
security.messages.access-denied=No tiene permisos para acceder a este recurso
security.messages.authentication-failed=Usuario o contraseña incorrectos
security.messages.account-locked=Cuenta bloqueada por múltiples intentos fallidos
security.messages.session-expired=Su sesión ha expirado, por favor inicie sesión nuevamente
security.messages.password-expired=Su contraseña ha expirado, debe cambiarla